<h1>Productos en tiempo real</h1>
<ul id="product-list"></ul>

<h2>Agregar producto</h2>
<form id="product-form">
  <input name="title" placeholder="Nombre"/>
  <input name="price" type="number" placeholder="Precio"/>
  <input name="category" placeholder="Categoría" />
  <button type="submit">Agregar</button>
</form>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io()

    const productList = document.getElementById("product-list")
    const form = document.getElementById("product-form")

    socket.on("updateProducts", (products) => {
        productList.innerHTML = ""
        products.forEach((p) => {
            const li = document.createElement("li")
            li.innerHTML = `${p.title} - $${p.price} <button onclick="deleteProduct(${p.id})">❌</button>`
            productList.appendChild(li)
        })
    })

    form.addEventListener("submit", (e) => {
        e.preventDefault()
        const data = Object.fromEntries(new FormData(form))
        data.price = Number(data.price)
        data.code = `COD-${Date.now()}`; 
        data.description = "Producto de demostración"; 
        data.status = true; 
        data.stock = 5;     
        data.thumbnails = []
        socket.emit("newProduct", data)
        form.reset()
    });

    function deleteProduct(id) {
        socket.emit("deleteProduct", id)
    }
</script>